name: üöÄ Laravel Multi-Env FTP Deployment

on:
  push:
    branches: [ main, master, dev ]
    paths-ignore:
      - 'README.md'
      - '.gitignore'
      - '.env.example'
  workflow_dispatch:

jobs:
  deploy-dev:
    if: github.ref == 'refs/heads/dev'
    name: üß™ Deploy to Development
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.2'

      - name: Composer Install
        run: composer install --no-interaction --prefer-dist

      # optional test/build steps here...

      - name: Deploy to Dev FTP
        uses: SamKirkland/FTP-Deploy-Action@v4
        with:
          server: ${{ secrets.DEV_FTP_HOST }}
          username: ${{ secrets.DEV_FTP_USERNAME }}
          password: ${{ secrets.DEV_FTP_PASSWORD }}
          exclude: |
            **/.git/**
            **/tests/**
            .env*
            README.md

  deploy-prod:
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
    name: üõ°Ô∏è Deploy to Production
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.2'

      - name: Composer Install
        run: composer install --no-interaction --prefer-dist

      # optional test/build steps here...

      - name: Deploy to Prod FTP
        uses: SamKirkland/FTP-Deploy-Action@v4
        with:
          server: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          exclude: |
            **/.git/**
            **/tests/**
            .env*
            README.md
